#!/bin/bash
set -euf -o pipefail

if [ "$TRAVIS_JOB" = "test" ]; then
    cd esp
    ./manage.py collectstatic --noinput -v 0
    # Run tests with JUnit XML output for CI artifact upload
    coverage run --source=. ./manage.py test \
        --testrunner=xmlrunner.extra.djangotestrunner.XMLTestRunner \
        --output-dir=test-results 2>&1 | tee test-output.log
    coverage xml
elif [ "$TRAVIS_JOB" = "lint" ]; then
    deploy/lint
else
    echo "Unknown TRAVIS_JOB: $TRAVIS_JOB"
    exit 1
fi
