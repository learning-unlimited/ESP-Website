{% extends "outlines/review_base.tex" %}

{% block content %}
{{ block.super }}
{% load survey %}

{\bf {\underline {\Large Survey Reviews for {{ user.name }}} \hspace{1in} }
\vspace*{0.1in}

\normalsize {{ program.niceName }}: {{ program.date_range }} } \\

\vspace{0.3in}

{% if not surveys|length_is:0 %}
Students from {{ prog.niceName }} filled out an online survey asking some questions about the program as a whole.  Their responses are summarized below.
{% endif %}

{% for s in surveys %}
\vspace{0.25in}
{% if not forloop.first %}\clearpage{% endif %}
    \begin{center}
    \begin{longtable}{|l|l|} \hline
    \multicolumn{2}{|c|}{\cellcolor{esphead} ~ } \\
    \multicolumn{2}{|c|}{\cellcolor{esphead} \Large {Responses for {{ s.name }}} } \\ 
    \multicolumn{2}{|c|}{\cellcolor{esphead} ~ } \\\hline
    {% for q in s.display_data.questions %} 
        {% if q.question.question_type.is_countable %}
            \begin{minipage}[b]{3in} {{ q.question.name }}: \\
                (Numerical responses) \vspace*{0.5in}

                \textbf{Number of responses:} {{ q.answers|length }}/{{ s.num_participants }} \\
                {% if q.question.question_type.is_numeric %}
                    \textbf{Average:} {{ q.answers|unpack_answers|average }} \\
                    \textbf{Std. deviation:} {{ q.answers|unpack_answers|stdev }} \\ ~\\
                    \textbf{Global average:} {{ q.question.global_average }}
                {% endif %}
            \end{minipage} & 
            {% if not q.answers|length_is:0 %}
            {{ q.answers|unpack_answers|histogram:"tex" }} 
            {% else %} There are no responses to this question.
            {% endif %} \\ \hline
        {% else %}
            \begin{minipage}{3in} 
                {{ q.question.name }} \vspace*{0.5in} 

                \textbf{Number of responses:} {{ q.answers|length }}/{{ s.num_participants }} \\
            \end{minipage} &
            \begin{minipage}{3in}
            {% if not q.answers|unpack_answers|length_is:0 %}
            \vspace*{0.1in} Responses include: \\ 
            \small
            \begin{itemize2}
            {% for a in q.answers|unpack_answers %}{% if not a|length_is:0 %}\item {{ a|texescape }}
            {% endif %}{% endfor %}
            \end{itemize2} \vspace*{0.1in} 
            {% else %} There are no responses to this question.
            {% endif %}
            \end{minipage} \\ \hline
        {% endif %}
    {% endfor %}
    \end{longtable}
    \end{center}
{% endfor %}


{% if perclass_data %}

Students were also asked a few questions about each of their classes.  The results for your classes are shown below.

\vspace{0.25in}

{% for c in perclass_data %}
{% if not forloop.first %}\clearpage{% endif %}
    \begin{center}
    \begin{longtable}{|l|l|} \hline
    \multicolumn{2}{|c|}{\cellcolor{esphead} ~ } \\
    \multicolumn{2}{|c|}{\cellcolor{esphead} \Large {Responses for {{ c.class.emailcode }}: {{ c.class.title|texescape }}} } \\ 
    \multicolumn{2}{|c|}{\cellcolor{esphead} ~ } \\\hline
    \multicolumn{2}{|c|}{Teachers: {{ c.class.getTeacherNames|join:", "|texescape }} } \\ \hline
    {% for q in c.questions %} 
        {% if q.question.question_type.is_countable %}
            \begin{minipage}[b]{3in} {{ q.question.name }}: \\
                (Numerical responses) \vspace*{0.5in}

                \textbf{Number of responses:} {{ q.answers|length }}/{{ c.class.num_students }} \\
                {% if q.question.question_type.is_numeric %}
                    \textbf{Average:} {{ q.answers|unpack_answers|average }} \\
                    \textbf{Std. deviation:} {{ q.answers|unpack_answers|stdev }} \\ ~\\
                    \textbf{Global average:} {{ q.question.global_average }}
                {% endif %}
            \end{minipage} & 
            {% if not q.answers|length_is:0 %}
    	    {{ q.answers|unpack_answers|histogram:"tex" }} 
            {% else %} There are no responses to this question.
            {% endif %} \\ \hline
        {% else %}
            \begin{minipage}{3in} 
                {{ q.question.name }} \vspace*{0.5in} 

                \textbf{Number of responses:} {{ q.answers|length }}/{{ c.class.num_students }} \\
            \end{minipage} &
    	    \begin{minipage}{3in}
            {% if not q.answers|length_is:0 %}
            \vspace*{0.1in} Responses include: \\ 
            \small
            \begin{itemize2}
            {% for a in q.answers|unpack_answers %}{% if not a|length_is:0 %}\item {{ a|texescape }}
            {% endif %}{% endfor %}
            \end{itemize2} \vspace*{0.1in} 
            {% else %} There are no responses to this question.
            {% endif %}
            \end{minipage} \\ \hline
        {% endif %}
    {% endfor %}
    \end{longtable}
    \end{center}
{% endfor %}
{% endif %}

{% endblock %}

