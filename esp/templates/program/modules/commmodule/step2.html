{% extends "main.html" %}

{% block title %}Communications Portal{% endblock %}

{% block subsection_name %}Communications Portal{% endblock %}

{% block xtrajs %}
{{block.super}}
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    function validateMsgLang() {
      var msgTypes = document.getElementsByName("msglang");
      var containsTag = /<(\/?((.)|(br ?\/?)))>|(<img)/i.test(
        document.getElementById("emailbody").value)
      var containsHTag = /<\/?html>/i.test(
        document.getElementById("emailbody").value)

      if(containsHTag) {
          return confirm("Didn't we say not to include <html> tags?!? "
                    + "If you're sure you know what you're doing, "
                    + "click 'OK' to continue.");
      } else if(msgTypes[1].checked && !containsTag) {
          return confirm('You selected "HTML" but included no HTML tags. '
                    + 'Continuing might squash your formatting. '
                    + 'Would you still like to proceed?');
      } else if(msgTypes[0].checked && containsTag) {
          return confirm('You selected "Plain Text" but have HTML tags '
                    + '(such as <p>) in your message. '
                    + 'Continuing will leave your tags in your message '
                    + '(so you might see "<b>hello</b>" instead of '
                    + 'a bold "hello"). '
                    + 'Would you still like to proceed?');
      }
      else {
          return true;
      }
    }
  </script>
{% endblock %}
{% block stylesheets %}
{{block.super}}
<style type="text/css">
.listtable, .listtable th, .listtable td{ border: 1px solid #999;
  border-collapse: collapse;}
#divmaintext .unchosen { background-color: #CCC; }
#divmaintext .chosen { background-color: #FFF; }
#divmaintext td.notchooser { cursor: pointer }
#finalsentence { border: 1px solid black; width: 550px; }
</style>
{% endblock %}

{% block content %}


<h1>Communications Portal</h1>
<br />
<h2>Step 2:</h2>

<br />
<p>
There are <strong>{{listcount}}</strong> distinct users in your query.
If you feel this to be off, please
<a href="javascript:history.go(-1);">go back</a> now.<br />
<br />

Please write your email message now. Note that you can use
<tt>&#123;&#123;parameter&#125;&#125;</tt> to enter a parameter into the text of the
message&mdash;the parameters are listed below. The default
{{ settings.ORGANIZATION_SHORT_NAME }} template (which you can modify
<a href="/admin/utils/templateoverride/?name=default_email_html.txt">here</a>)
is automatically wrapped around your message below.
You can choose to write the body in either plain text or HTML.
If you choose to use HTML, there is no need for &lt;html&gt; and &lt;/html&gt;
tags because they're are included in the wrapper template.
If you choose plain text, do <b>not</b> use any HTML tags for
whitespace.</p>

<form action="/manage/{{program.getUrlBase}}/commprev"
  onsubmit="return validateMsgLang()" name="comm2" method="post">

<table border="0" cellspacing="0" width="100%">
<tr>
  <input type="radio" name="msglang" id="msglang" value="plaintext">Plain Text
  <br />
  <input type="radio" name="msglang" id="msglang" value="html" required> HTML
<tr>
  <td>
  <label for="from">
  <strong>From:</strong>
  <small>(If blank: your email,
    <script type="text/javascript">document.write(esp_user.cur_username);</script>@{{ settings.SITE_INFO.1 }})</small>
  </label><br />
  <input type="text" size="30" name="from" id="from" value="{{from}}" />
  <br />
  <label for="replyto">
  <strong>Reply-To:</strong>
  <small>(If blank: same as "From")</small>
  </label><br />
  <input type="text" size="30" name="replyto" id="replyto" value="{{replyto}}" />
  <br />
  <label for="subject">
  <strong>Subject:</strong>
  </label><br />
  <input type="text" size="30" name="subject" id="subject" value="{{subject}}" required />
  <br /><br />
  <label for="emailbody">
  <strong>Body:</strong>
  </label> <br />
  <textarea cols="80" rows="20" name="body" id="emailbody" required />{{body}}</textarea>
  <br />

  </td>

  <td width="200">
   <table class="listtable" cellspacing="0">
    <tr>
      <th>Invocation</th>
      <th>Description</th>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}user.name{% templatetag closevariable %}
          </span>
      </th>
      <td>User's Full Name</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}user.username{% templatetag closevariable %}
          </span>
      </th>
      <td>User's ESP Web Site Username</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}user.first_name{% templatetag closevariable %}
          </span>
      </th>
      <td>User's First Name</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}user.last_name{% templatetag closevariable %}
          </span>
      </th>
      <td>User's Last Name</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.student_schedule{% templatetag closevariable %}
          </span>
      </th>
      <td>Student's schedule for Program</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.student_schedule_norooms{% templatetag closevariable %}
          </span>
      </th>
      <td>Student's schedule without room numbers</td>
    </tr>
        <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.teacher_schedule{% templatetag closevariable %}
          </span>
      </th>
      <td>Teacher's schedule for Program</td>
    </tr>
        <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.volunteer_schedule{% templatetag closevariable %}
          </span>
      </th>
      <td>Volunteer's schedule for Program</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.transcript{% templatetag closevariable %}
          </span>
      </th>
      <td>Transcript (classes and descriptions) for Program</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.receipt{% templatetag closevariable %}
          </span>
      </th>
      <td>Confirmation receipt for Program</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.full_classes{% templatetag closevariable %}
          </span>
      </th>
      <td>Newline-separated list of user's classes that have full or
        nearly-full sections</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.diag_sat_scores{% templatetag closevariable %}
          </span>
      </th>
      <td>User's Diagnostic SAT Scores</td>
    </tr>
    <tr>
      <th><span style="white-space: nowrap;">
     {% templatetag openvariable %}program.prac_sat_scores{% templatetag closevariable %}
          </span>
      </th>
      <td>User's Practice SAT Scores</td>
    </tr>
    </table>
  </td>


</tr>
</table>

<input type="submit" value="Go To Preview" name="submitform" />
<input type="hidden" name="listcount" value="{{listcount}}" />
<input type="hidden" name="filterid" value="{{filterid}}" />
<input type="hidden" name="sendto_fn_name" value="{{sendto_fn_name}}" />
</form>
{% endblock %}
