{% extends "main.html" %}
{% load render_qsd %}
{% load users %}

{% block title %} Manage Phase Zero for {{program.niceName}} {% endblock %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="/media/styles/forms.css" />
<link rel="stylesheet" href="/media/styles/expand_display.css" type="text/css" />

<style>
.button1 {
    text-align: center !important;
    float: none !important;
    height: 40px !important;
    width: 250px !important;
    font-size: 13px !important;
}

#applicants
{
    list-style-type: none;
    counter-reset: section;

    -moz-column-count: 3;
    -moz-column-gap: 20px;
    -webkit-column-count: 3;
    -webkit-column-gap: 20px;
    column-count: 3;
    column-gap: 20px;
    margin: 0px;
}

#record
{
    padding-left: 30px;
    position: relative;
}

#lotteryentries{
  display:none;
}
#lotteryentries.show{
  display:block;
}

table {
    border-collapse: collapse;
}

table, th, td {
    border: 1px solid black;
}

td {
    text-align: center;
}
.dsphead {
    text-align: center !important;
}
</style>
{% endblock %}

{% block content %}
<h1>Manage Phase Zero (Student Lottery) for {{program.niceName}}</h1>

<center>
<h2>
Number of students that have entered the student lottery:
</h2>
<h2 style="font-family:sans-serif">
<u>{{ nentrants }}</u>
</h2>

</br>
<input type="button" class="button1" value="Show/Hide Lottery Entrants" id="toggle" />

<div id="lotteryentries">
</br>
<ul id="applicants">
{% for entrant in entrants %}
<li>{{entrant}} - {{entrant|getGradeForProg:program.id}}</li>
{% endfor %}
</ul>
</div>

<center>
{% if error %}<p><font color="red">{{ error }}</font></p>{% endif %}
{% autoescape off %}
{% if lottery_messages %}<p><font color="blue">{{ lottery_messages|join:"<br/>" }}</font></p>{% endif %}
{% endautoescape %}

<hr>
<button class="dsphead">
    <b><u>Run Default Student Lottery Algorithm:</u></b>
</button>
<div class="dspcont">
    (Do not do this unless you know what you are doing)<br/><br/>
    <form action="#" method="POST">
        <input type="hidden" name="mode" value="default">
        {% if grade_caps %}
            The following grade capacities will be used</br>(as specified by the <i>program_size_by_grade</i> <a href="/manage/{{ program.getUrlBase }}/tags">tag</a>):</br>
            <table align="center" width="200">
                <tr>
                    <th>Grade(s)</th>
                    <th>Capacity</th>
                </tr>
                {% for grades, cap in grade_caps %}
                    <tr>
                        <td>
                            {{ grades|join:" - " }}
                        </td>
                        <td>
                            {{ cap }}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            You must set the <i>program_size_by_grade</i> <a href="/manage/{{ program.getUrlBase }}/tags">tag</a>.
        {% endif %}
        <!--<b>Specify Role Name for Winners: </b>--><input type="hidden" name="rolename" value="{{role}}"></br></br>
        <input type="checkbox" name="confirm">  I confirm that I would like to run the default student lottery algorithm.</br></br>
        <input {% if not grade_caps %}disabled {% endif %}type="submit" style="float:none" value="Run Default Student Lottery Algorithm" />
    </form>
</div>


<button class="dsphead">
    <b><u>Run Manual Student Lottery:</u></b>
</button>
<div class="dspcont">
    (Do not do this unless you know what you are doing)<br/><br/>
    <form action="#" method="POST">
        <input type="hidden" name="mode" value="manual">
        <textarea name="usernames" rows="6" placeholder="Enter comma-separated or space-separated student usernames here"></textarea>
        <!--<b>Specify Role Name for Winners: </b>--><input type="hidden" name="rolename" value="{{role}}"></br></br>
        <input type="checkbox" name="groups">  I would also like to accept any students in the same lottery groups.</br></br>
        <input type="checkbox" name="confirm">  I confirm that I would like to use the above list of students for a manual student lottery.</br></br>
        <input type="submit" style="float:none" value="Run Manual Student Lottery" />
    </form>
</div>

</center>

{% if stats %}
<hr>
<center><h2><u>Lottery Statistics</u></h2></center>
<table align="center" width="500">
    <tr>
	    <th>Grade</th>
	    <th># in Lottery</th>
        <th># Accepted</th>
        <th>% Accepted</th>
	</tr>
	{% for grade, stat in stats.items %}
        <tr>
            <td>
                {{ grade }}
            </td>
            <td>
                {{ stat.in_lottery }}
            </td>
            <td>
                {{ stat.num_accepted }}
            </td>
            <td>
                {{ stat.per_accepted }}
            </td>
        </tr>
    {% endfor %}
</table>
{% endif %}

<script type="text/javascript" src="/media/scripts/expand_display.js"></script>

<script>
var toggle  = document.getElementById("toggle");
var content = document.getElementById("lotteryentries");

toggle.addEventListener("click", function(){
  content.classList.toggle("show");
}, false);
</script>
{% endblock %}
