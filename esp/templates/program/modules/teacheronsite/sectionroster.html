{% extends "program/modules/teacheronsite/webapp.html" %}

{% block head %}
<script src="https://webrtc.github.io/adapter/adapter-latest.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/serratus/quaggaJS@e96eb9f7888507689cf33f1e6ce325959dde314e/dist/quagga.min.js" type="text/javascript"></script>
<script src="/media/scripts/barcodescanner.js" type="text/javascript"></script>
<script>
var message = '';
var lastResult = '';
Quagga.onDetected(function(result) {
    var code = result.codeResult.code;

    if (lastResult !== code) {
        beep();
        lastResult = code;
        var results = document.querySelector('textarea');
        var codes = results.value.trim().split(/\s+/).filter(Boolean);
        console.log(codes);
        if (!codes.includes(code)) {
            codes.push(code);
            results.value = codes.join("\n");
            message = code+' added to list';
        } else {
            message = code+' already in list';
        }
        $j('#scaninfo').show();
        $j('#scaninfo').html(message);
        setTimeout("$j('#scaninfo').fadeOut(); ", 4000);
    }
});
    
function toggleCheck(element) {
    var checkbox = element.nextElementSibling;
    if (checkbox.checked) {
        element.innerHTML = "check_box_outline_blank";
    } else {
        element.innerHTML = "check_box";
    }
    checkbox.checked = !checkbox.checked;
}
</script>
{% endblock %}

{% block body %}
{% load users %}
<center>
  <div class="main">
    {% for section in sections %}
        {% if sections|length_is:"1" %}
        <form action="/teach/{{ one }}/{{ two }}/section_attendance/{{ section.id }}" method="post">
        <input type="hidden" name="submitted">
        {% endif %}
        <table class="sectionroster">
            <tr>
                <th colspan="4" class="sectiontitle">
                    <i>Roster for {{ section }}</i>
                </th>
            </tr>
            <tr>
                <th colspan="4">
                    Enrolled Students
                </th>
            </tr>
            <tr class="rosterheader">
                <th>
                    Name
                </th>
                <th>
                    Grade
                </th>
                <th>
                    Checked In
                </th>
                <th>
                    Attending Class?
                </th>
            </tr>
            {% for student in section.enrolled_list %}
                <tr>
                    <td>{{ student.name }}</td>
                    <td>{{ student|getGradeForProg:program.id }}</td>
                    <td><i class="material-icons-outlined md-5">{% if student.checked_in %}check_box{% else %}check_box_outline_blank{% endif %}</i></td>
                    <td>
                        <i class="material-icons-outlined md-5{% if sections|length_is:'1' %} pointer{% endif %}"{% if sections|length_is:'1' %} onclick="toggleCheck(this);"{% endif %}>{% if student.attended %}check_box{% else %}check_box_outline_blank{% endif %}</i>
                        <input type="checkbox" name="attending" value="{{ student.id }}" hidden{% if student.attended %} checked{% endif %}>
                    </td>
                </tr>
            {% endfor %}
            {% if section.attended_list %}
                <tr>
                    <th colspan="4">
                        Other Attending Students
                    </th>
                </tr>
                <tr class="rosterheader">
                    <th>
                        Name
                    </th>
                    <th>
                        Grade
                    </th>
                    <th>
                        Checked In
                    </th>
                    <th>
                        Attending Class?
                    </th>
                </tr>
                {% for student in section.attended_list %}
                    <tr>
                        <td>{{ student.name }}</td>
                        <td>{{ student|getGradeForProg:program.id }}</td>
                        <td><i class="material-icons-outlined md-5">{% if student.checked_in %}check_box{% else %}check_box_outline_blank{% endif %}</i></td>
                        <td>
                            <i class="material-icons-outlined md-5{% if sections|length_is:'1' %} pointer{% endif %}"{% if sections|length_is:'1' %} onclick="toggleCheck(this);"{% endif %}>{% if student.attended %}check_box{% else %}check_box_outline_blank{% endif %}</i>
                            <input type="checkbox" name="attending" value="{{ student.id }}" hidden{% if student.attended %} checked{% endif %}>
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </table>
        {% if sections|length_is:"1" %}
        
        </form>
        {% endif %}
        {% if not forloop.last %}
            <hr size="5" noshade="" style="margin: 0px;">
        {% endif %}
    {% endfor %}
    <table style="height:8vh; border:none;"><tr style="border:none;"><td style="border:none;"></td></tr></table>
  </div>
</center>
<div class="navbar bottom">
  <table>
    <tr>
      <td><a class="no-dec" href="/teach/{{one}}/{{two}}/onsitedetails/{% if sections|length_is:'1' %}{{ sections.0.id }}{% endif %}" style="display:block;"><i class="material-icons md-5">list</i>
        <br>Section Info</td>
      <td class="selected"><a class="no-dec" href="/teach/{{one}}/{{two}}/onsiteroster/{% if sections|length_is:'1' %}{{ sections.0.id }}{% endif %}" style="display:block;"><i class="material-icons md-5">assignment</i>
        <br>Section Roster</td>
    </tr>
  </table>
</div>

{% endblock %}