{% extends "main.html" %}

{% block title %}Set Deadlines{% endblock %}

{% block keywords %}{% endblock %}
{% block description %}{% endblock %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="/media/styles/forms.css" />
    <link rel="stylesheet" type="text/css" href="/media/styles/jquery-ui/jstree/style.css" />
    <link rel="stylesheet" type="text/css" href="/media/styles/deadlines.css" />
    <link rel="stylesheet" href="/media/styles/expand_display.css" type="text/css" />
{% endblock %}

{% block xtrajs %}
    <script type="text/javascript" src="/media/scripts/jquery.jstree.js"></script>
{% endblock %}

{% block content %}
{% load users %}
<div id="userbitforms">
<p><h1>Deadline Management</h1></p>

{% if message_good %}
    <div class="alert alert-success">
        <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
            {{ message_good }}
    </div>
{% endif %}
{% if message_bad %}
    <div class="alert alert-danger">
        <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
            {{ message_bad }}
    </div>
{% endif %}

<p>Access to each program's Web pages (including registration pages) is controlled by a set of deadlines, each of which prescribes when a certain set of activities can be performed.  "Recursive" deadlines can control a range of activities jointly; you may open all registration features using a single recursive deadline (e.g., "All student deadlines"), or specify several non-recursive deadlines ("Register for classes", "Access to survey", etc.) for finer control.</p>

<p>If you use recursive deadlines, keep in mind that the "implied" deadlines can only be used to open registration features when the recursive deadline is closed; you cannot close implied deadlines to override an open recursive deadline.  Hence it is wise to make the deadlines non-recursive when controlling individual registration features.</p>

<p>Please proceed to edit <a href="#existing">existing deadlines</a> or <a href="#new">create a new deadline</a> if necessary.</p>

{% include "program/modules/admincore/returnlink.html" %}

<a name="existing"></a>
<h2>Existing Deadlines</h2>

<form method="post" action="/manage/{{ program.getUrlBase }}/deadlines" id="manage_form">
{% autoescape off %}
{{ manage_form }}

{% for group, perm_types in group_perms.items %}
<button type="button" class="dsphead">
   <b>{{ group }}s</b> (click to expand/contract)
</button>
<div class="dspcont">
    <table width="100%" cellspacing="0" cellpadding="3px">
        <colgroup>
           <col span="1" width="30%">
           <col span="1">
           <col span="1">
           <col span="1" width="15%">
        </colgroup>
        <tbody>
        {% for perm_type, details in perm_types.items %}
            {% if forloop.counter0|divisibleby:"5" %}
            <tr>
                <th>Deadline</th>
                <th>Start</th>
                <th>End</th>
                <th></th>
            </tr>
            {% endif %}
            <tr style="border-top: 1px solid grey;{% if details.perms|length_is:1 %}border-bottom: 1px solid grey;{% endif %}">
                <th class="{% if details.is_open %}is_open{% else %}is_closed{% endif %}" rowspan = "{% if details.perms|length_is:0 %}1{% else %}{{ details.perms|length }}{% endif %}">
                    {{ perm_type|perm_nice_name }}{% if details.recursive %}<br /><span style="color: royalblue;">(recursive)</span>{% endif %}<br>
                    <span class="bituri">{{ perm_type }}</span>
                    <br /><br />
                    {% if details.is_open %}
                        <a {% if not details.implied_open %}href="/manage/{{ program.getUrlBase }}/deadlines/close?group={{ group.id }}&perm={{ perm_type|urlencode }}"{% endif %}><button {% if details.implied_open %}disabled title="Can not be closed due to implied permission" {% endif %}type="button" class="btn btn-danger">Close</button></a>
                    {% else %}
                        <a href="/manage/{{ program.getUrlBase }}/deadlines/open?group={{ group.id }}&perm={{ perm_type|urlencode }}"><button type="button" class="btn btn-success">Open</button></a>
                    {% endif %}
                </th>
            {% for perm in details.perms %}
                {% if not forloop.first %}
                <tr{% if forloop.last %} style="border-bottom: 1px solid grey;"{% endif %}>
                {% endif %}
                <td>{{ perm.form.id }}{{ perm.form.skip }}{{ perm.form.start_date }}</td>
                <td>{{ perm.form.end_date }}</td>
                <td align="center" valign="center">
                    {% if perm.implied %}
                        Implied by {{ perm.implied_by.permission_type }}
                    {% else %}
                        <input class="btn btn-primary" type="Submit" name="submit_btn" value="Save" />
                        {% if details.perms|length > 1 %}
                            <a href="/manage/{{ program.getUrlBase }}/deadlines/delete?perm_id={{ perm.id }}"><button type="button" class="btn btn-danger btn-small">Delete</button></a>
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% empty %}
                <td colspan="3">No permission set</td>
            </tr>
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>
</div>
{% endfor %}
{% endautoescape %}

</form>

<form method="post" action="/manage/{{ program.getUrlBase }}/deadlines" id="create_form">

<a name="new"></a>
<h2>Create new deadlines</h2>

<p>If you have made changes to the current deadlines, please click "Save Changes" above before creating a new deadline.</p>

{% autoescape off %}
<table cellspacing="0" width="550px" cellpadding="3">
{{ create_form }}
<tr>
    <td align="center" valign="center" colspan="2">
        <input class="button" type="Submit" name="submit_btn" value="Create Deadline" />
    </td>
</tr>
</table>
{% endautoescape %}
</form>

</div>

<script type="text/javascript" src="/media/scripts/expand_display.js"></script>
{% endblock %}
