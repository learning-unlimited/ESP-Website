{% extends "main.html" %}

{% block title %}{{ program.niceName }} Management{% endblock %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" href="/media/styles/forms.css" type="text/css" />
{% endblock %}

{% block content %}
{% load users %}
{% load modules %}
<h1>Student Attendance for {{ program.niceName }}</h1>

<div id="program_form">

<p>
{% if timeslot %}
<form action="/onsite/{{ one }}/{{ two }}/attendance/{{ timeslot.id }}" method="get">
Here is an attendance summary for {{ timeslot }} at <input name="when" type="datetime-local" onchange="$j(this).parents('form').submit();return false;" value="{{ when|date:'Y-m-d' }}T{{ when|time:'H:i' }}">. Here you can see attendance statistics and details for students that have been checked in during this timeslot, students that are not attending class, and students that are attending classes they were not originally enrolled in. If you are looking for a different timeslot, you can select it from the dropdown below.
</form>
{% else %}
Please select a timeslot from the dropdown below.
{% endif %}
<br />
</p>

<center>
    <select name="tsid" onchange="location.href='/onsite/{{ one }}/{{ two }}/attendance/'+$j(this).children('option:selected').val()" style="width: 400px;">
        {% if not timeslot %}
            <option disabled selected="selected">
                (Select a timeslot)
            </option>
        {% endif %}
        {% for ts in program.getTimeSlots %}
            <option value="{{ ts.id }}" {% if ts == timeslot %}selected="selected"{% endif %}>
                {{ ts }}
            </option>
        {% endfor %}
    </select>
</center>

{% if timeslot %}
<center>
<table>
<tr>
    <th width="33%"># Students<br />Checked In<br />To the Program</th>
    <th width="33%"># Students<br />Enrolled in Classes<br />This Timeslot</th>
    <th width="33%"># Students<br />Attending Classes<br />This Timeslot</th>
</tr>
<tr>
    <td align="center">{{ checked_in.count }}</td>
    <td align="center">{{ enrolled.count }}</td>
    <td align="center">{{ attended.count }}</td>
</tr>
</table>
<br />
<table>
<tr>
    <th colspan="6">Students Checked In Between {{ timeslot.start_w_buffer|date:"g:i A" }} and {{ timeslot.end|date:"g:i A" }} </th>
</tr>
<tr>
    <th width="5%">#</th>
    <th width="30%">Student Name</th>
    <th width="15%">Student Username</th>
    <th width="10%">Student ID #</th>
    <th width="10%">Student Grade</th>
    <th width="20%">School</th>
</tr>
{% for student in checked_in_ts %}
<tr>
    <th class="small">{{ forloop.counter }}</th>
    <td>{{ student.name }}</td>
    <td>{{ student.username }}</td>
    <td>{{ student.id }}</td>
    <td>{{ student|getGradeForProg:program.id }}</td>
    <td>{{ student.getLastProfile.student_info.getSchool }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="6" align="center">No students checked in during this timeslot</td>
</tr>
{% endfor %}
</table>
<table width="100%" style="border: none;">
    {% if program|hasModule:"ListGenModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/selectList?userid={% for student in checked_in_ts %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Get Student Information
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"CommModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/commpanel?userid={% for student in checked_in_ts %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Email Students
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"GroupTextModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/grouptextpanel?userid={% for student in checked_in_ts %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Text Students
            </a>
        </td>
    {% endif %}
</table>
<br />
<table>
<tr>
    <th colspan="7">Students Checked In But Not Attending Class</th>
</tr>
<tr>
    <th width="5%">#</th>
    <th width="20%">Student Name</th>
    <th width="15%">Student Username</th>
    <th width="10%">Student ID #</th>
    <th width="10%">Student Grade</th>
    <th width="20%">School</th>
    <th width="20%">Enrolled Class</th>
</tr>
{% for student in not_attending %}
<tr>
    <th class="small">{{ forloop.counter }}</th>
    <td>{{ student.name }}</td>
    <td>{{ student.username }}</td>
    <td>{{ student.id }}</td>
    <td>{{ student|getGradeForProg:program.id }}</td>
    <td>{{ student.getLastProfile.student_info.getSchool }}</td>
    <td>{{ student.missed_class }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="7" align="center">No students checked in but not attending class</td>
</tr>
{% endfor %}
</table>
<table width="100%" style="border: none;">
    {% if program|hasModule:"ListGenModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/selectList?userid={% for student in not_attending %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Get Student Information
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"CommModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/commpanel?userid={% for student in not_attending %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Email Students
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"GroupTextModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/grouptextpanel?userid={% for student in not_attending %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Text Students
            </a>
        </td>
    {% endif %}
</table>
<br />
<table>
<tr>
    <th colspan="8">Students Attending Classes In Which They Weren't Originally Enrolled</th>
</tr>
<tr>
    <th width="5%">#</th>
    <th width="15%">Student Name</th>
    <th width="15%">Student Username</th>
    <th width="10%">Student ID #</th>
    <th width="10%">Student Grade</th>
    <th width="15%">School</th>
    <th width="15%">Attended Class</th>
    <th width="15%">Enrolled Class</th>
</tr>
{% for student in onsite %}
<tr>
    <th class="small">{{ forloop.counter }}</th>
    <td>{{ student.name }}</td>
    <td>{{ student.username }}</td>
    <td>{{ student.id }}</td>
    <td>{{ student|getGradeForProg:program.id }}</td>
    <td>{{ student.getLastProfile.student_info.getSchool }}</td>
    <td>{{ student.attended_class }}</td>
    <td>{{ student.enrolled_class }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="8" align="center">No students attending students in which they weren't enrolled</td>
</tr>
{% endfor %}
</table>
<table width="100%" style="border: none;">
    {% if program|hasModule:"ListGenModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/selectList?userid={% for student in onsite %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Get Student Information
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"CommModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/commpanel?userid={% for student in onsite %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Email Students
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"GroupTextModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/grouptextpanel?userid={% for student in onsite %}{{ student.id }}{% if not forloop.last %},{% endif %}{% endfor %}">
                Text Students
            </a>
        </td>
    {% endif %}
</table>
<br />
<table>
<tr>
    <th colspan="6">Sections with No Attendance Recorded</th>
</tr>
<tr>
    <th width="5%">#</th>
    <th width="10%">Email Code</th>
    <th width="30%">Class Title</th>
    <th width="20%">Teachers</th>
    <th width="20%">Times</th>
    <th width="15%"># Students Enrolled</th>
</tr>
{% for section in no_attendance %}
<tr>
    <th class="small">{{ forloop.counter }}</th>
    <td>{{ section.emailcode }}</td>
    <td>{{ section.title }}</td>
    <td>{{ section.parent_class.pretty_teachers }}</td>
    <td>{{ section.friendly_times_with_date|join:", " }}</td>
    <td>{{ section.num_students }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="6" align="center">No sections without attendance recorded</td>
</tr>
{% endfor %}
</table>
<table width="100%" style="border: none;">
    {% if program|hasModule:"ListGenModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/selectList?userid={% for section in no_attendance %}{% for teacher in section.teachers %}{{ teacher.id }}{% if not forloop.last %},{% endif %}{% endfor %}{% if not forloop.last %},{% endif %}{% endfor %}">
                Get Teacher Information
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"CommModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/commpanel?userid={% for section in no_attendance %}{% for teacher in section.teachers %}{{ teacher.id }}{% if not forloop.last %},{% endif %}{% endfor %}{% if not forloop.last %},{% endif %}{% endfor %}">
                Email Teachers
            </a>
        </td>
    {% endif %}
    {% if program|hasModule:"GroupTextModule" %}
        <td width="33%" align="center">
            <a href="/manage/{{ one }}/{{ two }}/grouptextpanel?userid={% for section in no_attendance %}{% for teacher in section.teachers %}{{ teacher.id }}{% if not forloop.last %},{% endif %}{% endfor %}{% if not forloop.last %},{% endif %}{% endfor %}">
                Text Teachers
            </a>
        </td>
    {% endif %}
</table>
</center>
{% endif %}

</div>

{% include "program/modules/onsitecore/returnlink.html" %}


{% endblock %}
