{% extends "main.html" %}

{% block title %}User Information{% endblock %}

{% load modules %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="/media/styles/tooltips.css" />
<link rel="stylesheet" type="text/css" href="/media/styles/forms.css" />
<link rel="stylesheet" type="text/css" href="/media/styles/userview.css" />
{% endblock %}

{% block content %}
{% with user.getLastProfile as profile %}
<h1>User Information</h1>
{% if not user.is_active %} <b>This user has been deactivated.</b> {% endif %}

<div id="user-sidebar">
    {% if teacherbio.picture %}<img src="{{ teacherbio.picture.url }}" title="Picture of {{ user.first_name }} {{ user.last_name }}"
        alt="Picture of {{ user.first_name }} {{ user.last_name }}" class="biophoto" />{% endif %}
    <form class="change-program" method="get">
        <input type="hidden" name="username" value="{{user.username}}"/>
        View:
        <select name="program" onchange="$j(this).parent().submit();return false;">
            {% for prog in all_programs %}
            <option value="{{prog.id}}" {% if prog == program %}selected="selected"{% endif %}>
                {{prog.name}}
            </option>
            {% endfor %}
        </select>
    </form>
    <a id="morphlink" class="sidelink" href="/myesp/morph?morph_user={{user.id}}">Morph into this user</a>
    {% if program %}
    <a id="onsitelink" class="sidelink" href="/myesp/morph?morph_user={{user.id}}&onsite={{program.id}}">Onsite for {{program.niceName}}</a>
    {% endif %}
    <a class="sidelink" href="/admin/users/espuser/{{user.id}}/">View on admin panel</a>
    <a class="sidelink" href="/admin/program/registrationprofile/?user__id={{user.id}}">View registration profiles</a>
    <form action="/manage/{% if user.is_active %}de{% endif %}activate_user" method="post">{% csrf_token %}
        <input type="hidden" name="user_id" value="{{user.id}}"/>
        <a class="sidelink" onclick="$j(this).parent().submit();return false;" href="">{% if user.is_active %}Deactivate{% else %}Activate{% endif %} user</a>
    </form>
    {% if profile.teacher_info and program and program|hasModule:"AvailabilityModule" %}
        <a class="sidelink" href="/manage/{{program.getUrlBase}}/check_availability?user={{user.username}}">
            Check availability for {{program.niceName}}</a>
    {% endif %}
    {% if profile.student_info %}
        {% if program and program|hasModule:"AccountingModule" %}
            <a href="/manage/{{program.getUrlBase}}/accounting/{{user.id}}" class="sidelink">View accounting info</a>
        {% endif %}
        {% if program and program|hasModule:"FormstackMedliabModule" %}
            <form action="/manage/{{program.getUrlBase}}/medicalbypass" method="post">{% csrf_token %}
                <input type="hidden" name="target_user" value="{{user.id}}"/>
                <a class="sidelink" onclick="$j(this).parent().submit();return false;"
                   href="/manage/{{program.getUrlBase}}/medicalbypass">
                    Grant medical bypass for {{program.niceName}}</a>
            </form>
        {% endif %}
        {% if program %}
        <div id="print-student-schedule">
            <h2>
                Student schedule
            </h2>
            <p>(for {{program.niceName}})</p>
            <a id="getstudentschedulelink" class="sidelink" href="/onsite/{{program.getUrlBase}}/studentschedule?user={{user.id}}" target="_new">Print locally</a>
            <a id="printstudentschedulelink" class="sidelink" href="/onsite/{{program.getUrlBase}}/printschedule?user={{user.id}}&next=/manage/userview?username={{user.username}}">Print to default printer</a>
            {% if printers %}
                {% for printer in printers %}
                <a id="printstudentschedulelink-{{printer|slugify}}" class="sidelink" href="/onsite/{{program.getUrlBase}}/printschedule?user={{user.id}}&printer={{ printer }}&next=/manage/userview?username={{user.username}}">Print to {{ printer }}</a>
                {% endfor %}
            {% endif %}
        </div>
        {% else %}
            (Student has no profiles for programs)
        {% endif %}
    {% endif %}
    {% if profile.teacher_info %}
        {% if program %}
            <div id="print-teacher-schedule">
                <h2>
                    Teacher schedule<br/>
                    (for {{program.niceName}})
                </h2>
                <a id="getteacherschedulelink" class="sidelink" href="/teach/{{program.getUrlBase}}/teacherschedule?user={{profile.user.id}}" target="_new">Print locally</a>
            </div>
        {% else %}
            (Teacher has no profiles for programs)
        {% endif %}
    {% endif %}
</div>

<table class="dottedtable">
<tr><td class="key">Name</td><td>{{ user.first_name }} {{ user.last_name }}</td></tr>
<tr><td class="key">Gender</td><td>{% if profile.student_info.gender %}{{ profile.student_info.gender }}{% else %}Not specified{% endif %}</td></tr>
<tr><td class="key">Username</td><td>{{ user.username }}</td></tr>
<tr><td class="key">User ID</td><td>{{ user.id }}</td></tr>
{% if profile.contact_user %}
<tr><td class="key">E-mail</td><td>{{ profile.contact_user.e_mail }}</td></tr>
<tr><td class="key">Day Phone</td><td>{{ profile.contact_user.phone_day }}</td></tr>
<tr><td class="key">Cell Phone</td><td>{{ profile.contact_user.phone_cell }}</td></tr>
<tr><td class="key">Address</td><td>{{ profile.contact_user.address_street }}<br />{{ profile.contact_user.address_city }}, {{ profile.contact_user.address_state }} {{ profile.contact_user.address_zip }}{% if profile.contact_user.undeliverable %}<br /><font color="red">Mail has bounced!</font>{% endif %}</td></tr>
{% else %}
<tr><td class="key">E-mail</td><td>{{ user.email }}</td></tr>
<tr><td colspan="2"><font color="red">User account not fully created; please fill out a profile!</font></td></tr>
{% endif %}
</table>

<div id="div_usertype_info">
{% if profile.teacher_info.bio %}
<p><strong>Bio:</strong> {{ profile.teacher_info.bio }}</p>
{% endif %}

{% if profile.student_info %}
<h2>Student Info</h2>
<table class="dottedtable long">
<tr><td class="key">School</td><td>{{ profile.student_info.school }}</td></tr>
<tr><td class="key">Graduation Year</td><td>{{ profile.student_info.graduation_year }} ({{ user.getGrade }}th Grade)<br />
<form action="/manage/userview/" method="get" name="change_grade">
{{ change_grade_form.graduation_year }}
<input type="hidden" name="username" value="{{ user.username }}" />
<input type="submit" value="Change" class="btn btn-default" />
</form></td></tr>
<tr><td class="key">Date of Birth</td><td>{{ profile.student_info.dob|date }}</td></tr>
<tr><td class="key">Applied to be Student Rep?</td><td>{% if profile.student_info.studentrep %}<span class="yes"><a class="tooltip">Yes<span>{{ profile.student_info.studentrep_expl }}</span></a></span>{% else %}<span class="no">No</span>{% endif %}</td></tr>
<tr><td class="key">How Heard About ESP?</td><td>{% ifnotequal profile.student_info.heard_about "" %}<span>{{ profile.student_info.heard_about }}</span>{% else %}(blank){% endifnotequal %}</td><tr>
</table>
{% endif %}

{% if profile.teacher_info %}
<h2>Teacher Info</h2>
<table class="dottedtable long">
    <tr><td class="key">Affiliation</td><td>{{ profile.teacher_info.affiliation }}</td></tr>
    <tr><td class="key">Graduation Year</td><td>{{ profile.teacher_info.graduation_year }}</td></tr>
<tr><td class="key">College/Employer</td><td>{{ profile.teacher_info.college }}</td></tr>
<tr><td class="key">Major</td><td>{{ profile.teacher_info.major }}</td></tr>
<tr><td class="key">Shirt Size/Type</td><td>{{ profile.teacher_info.shirt_size }} {{ profile.teacher_info.shirt_type }}</td></tr>
</table>
{% endif %}

{% if profile.guardian_info %}
<table class="dottedtable long">
<tr><td class="key">Year Finished School</td><td>{{ profile.guardian_info.year_finished }}</td></tr>
<tr><td class="key">Number of Children in ESP</td><td>{{ profile.guardian_info.num_kids }}</td></tr>
</table>
{% endif %}

{% if profile.educator_info %}
<table class="dottedtable long">
<tr><td class="key">Subjects Taught</td><td>{{ profile.educator_info.subject_taught }}</td></tr>
<tr><td class="key">Years Taught</td><td>{{ profile.educator_info.grades_taught }}</td></tr>
<tr><td class="key">School</td><td>{{ profile.educator_info.school }}</td></tr>
<tr><td class="key">Position</td><td>{{ profile.educator_info.position }}></td></tr>
</table>
{% endif %}

</div>

<h2>Emergency Contact Info</h2>
{% if profile.contact_emergency %}{# We want to explicitly say "no contact info here!" if we don't have any, so that, in an emergency, folks don't start burning admin power digging through the database for contact info that we don't have #}
<table class="dottedtable long">
<tr><td class="key">Name</td><td>{{ profile.contact_emergency.first_name }} {{ profile.contact_emergency.last_name }}</td></tr>
<tr><td class="key">E-mail</td><td>{{ profile.contact_emergency.e_mail }}</td></tr>
<tr><td class="key">Day Phone</td><td>{{ profile.contact_emergency.phone_day }}</td></tr>
<tr><td class="key">Cell Phone</td><td>{{ profile.contact_emergency.phone_cell }}</td></tr>
<tr><td class="key">Address</td><td>{{ profile.contact_emergency.address_street }}<br />{{ profile.contact_emergency.address_city }}, {{ profile.contact_emergency.address_state }} {{ profile.contact_emergency.address_zip }}{% if profile.contact_emergency.undeliverable %}<br /><font color="red">Mail has bounced!</font>{% endif %}</td></tr>
</table>
{% else %}
<em>(None specified)</em>
{% endif %}


{% if profile.contact_guardian %}
<h2>Parent/Guardian Contact Info</h2>
<table class="dottedtable long">
<tr><td class="key">Name</td><td>{{ profile.contact_guardian.first_name }} {{ profile.contact_guardian.last_name }}</td></tr>
<tr><td class="key">E-mail</td><td>{{ profile.contact_guardian.e_mail }}</td></tr>
<tr><td class="key">Day Phone</td><td>{{ profile.contact_guardian.phone_day }}</td></tr>
<tr><td class="key">Cell Phone</td><td>{{ profile.contact_guardian.phone_cell }}</td></tr>
<tr><td class="key">Address</td><td>{{ profile.contact_guardian.address_street }}<br />{{ profile.contact_guardian.address_city }}, {{ profile.contact_guardian.address_state }} {{ profile.contact_guardian.address_zip }}{% if profile.contact_guardian.undeliverable %}<br /><font color="red">Mail has bounced!</font>{% endif %}</td></tr>
</table>
{% endif %}

{% endwith %}

{% with taught_classes as classes %}{% if classes %}
<h2>Classes Taught (or signed up to teach)</h2>
<br />
{% for class in classes %}
{% ifchanged class.parent_program %}{% if not forloop.first %}</ul>{% endif %}{{ class.parent_program.niceName }}<br /><ul>{% endifchanged %}
{% with show_class_details="True" %}
{% include "users/userview_class_entry.html" %}
{% endwith %}
{% if forloop.last %}</ul>{% endif %}
{% endfor %}
{% endif %}{% endwith %}

{% with enrolled_classes as classes %}{% if classes %}
<h2>Classes Enrolled In (currently or previously):</h2>
<br />
{% for class in classes %}
{% ifchanged class.parent_class.parent_program %}{% if not forloop.first %}</ul>{% endif %}{{ class.parent_class.parent_program.niceName }}<br /><ul>{% endifchanged %}
{% with show_class_details="True" %}
{% include "users/userview_class_entry.html" %}
{% endwith %}
{% if forloop.last %}</ul>{% endif %}
{% endfor %}
{% endif %}{% endwith %}

{% with taken_classes as classes %}{% if classes %}
<h2>Classes Taken Or Applied For:</h2>
<br />
{% for class in classes %}
{% ifchanged class.parent_class.parent_program %}{% if not forloop.first %}</ul>{% endif %}{{ class.parent_class.parent_program.niceName }}<br /><ul>{% endifchanged %}
{% include "users/userview_class_entry.html" %}
{% if forloop.last %}</ul>{% endif %}
{% endfor %}
{% endif %}{% endwith %}

{% endblock %}
